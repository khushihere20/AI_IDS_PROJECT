<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI IDS Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #f4f6f9;
        }
        .card {
            border-radius: 10px;
        }
        .metric-card h3 {
            font-weight: bold;
        }
    </style>
</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-dark bg-dark px-4">
    <span class="navbar-brand fw-bold">
        üõ° AI Intrusion Detection System
    </span>
    <div class="text-white">
        {{ user }} |
        <a href="/logout" class="text-warning text-decoration-none fw-bold">
            Logout
        </a>
    </div>
</nav>

<div class="container mt-4">

    <!-- ================= ERROR ================= -->
    {% if error %}
        <div class="alert alert-danger">
            {{ error }}
        </div>
    {% endif %}

    <!-- ================= RESULT ================= -->
    {% if result %}
        <div class="alert alert-info fw-bold">
            {{ result }}
        </div>
    {% endif %}

    <!-- ================= SOC DASHBOARD ================= -->
    {% if soc %}
    <div class="row mb-4">

        <div class="col-md-3">
            <div class="card shadow text-center metric-card">
                <div class="card-body">
                    <h6>Total Traffic</h6>
                    <h3>{{ soc.total }}</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow text-center metric-card">
                <div class="card-body">
                    <h6>Intrusions</h6>
                    <h3 class="text-danger">{{ soc.intrusions }}</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow text-center metric-card">
                <div class="card-body">
                    <h6>Normal</h6>
                    <h3 class="text-success">{{ soc.normal }}</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow text-center metric-card">
                <div class="card-body">
                    <h6>Risk Level</h6>
                    <span class="badge fs-6
                        {% if soc.risk == 'High' %} bg-danger
                        {% elif soc.risk == 'Medium' %} bg-warning
                        {% else %} bg-success {% endif %}">
                        {{ soc.risk }}
                    </span>
                    <div class="small text-muted mt-2">
                        Last: {{ soc.latest }} <br>
                        {{ soc.time }}
                    </div>
                </div>
            </div>
        </div>

    </div>
    {% endif %}

    <!-- ================= MODES ================= -->
    <div class="row">

        <!-- CSV MODE -->
        <div class="col-md-6">
            <div class="card shadow mb-4">
                <div class="card-header fw-bold">
                    üìÅ CSV Traffic Analysis
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        <input type="file" name="csv_file" class="form-control mb-3" required>
                        <button class="btn btn-primary w-100">
                            Analyze CSV
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- LIVE MODE -->
        <div class="col-md-6">
            <div class="card shadow mb-4">
                <div class="card-header fw-bold">
                    ‚ö° Live Detection (Quick Test)
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="mode" value="live">

                        <div class="row">
                            {% for f in range(6) %}
                            <div class="col-md-4 mb-2">
                                <input class="form-control"
                                       name="{{ f }}"
                                       placeholder="Feature {{ f + 1 }}"
                                       required>
                            </div>
                            {% endfor %}
                        </div>

                        <button class="btn btn-danger w-100 mt-2">
                            Detect Intrusion
                        </button>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <!-- ================= CHART ================= -->
    {% if chart_data %}
    <div class="card shadow mb-4">
        <div class="card-header fw-bold">
            üìä Attack Distribution
        </div>
        <div class="card-body">
            <canvas id="attackChart"></canvas>
        </div>
    </div>

    <script>
        const chartData = {
            labels: {{ chart_data.keys() | list | safe }},
            datasets: [{
                label: "Traffic Count",
                data: {{ chart_data.values() | list | safe }},
                backgroundColor: [
                    "#dc3545", "#ffc107", "#0d6efd",
                    "#198754", "#6f42c1"
                ]
            }]
        };

        new Chart(document.getElementById("attackChart"), {
            type: "bar",
            data: chartData,
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                }
            }
        });
    </script>
    {% endif %}

    <!-- ================= TABLE ================= -->
    {% if table %}
    <div class="card shadow mb-4">
        <div class="card-header fw-bold">
            üìã Detection Output (Sample)
        </div>
        <div class="card-body table-responsive">
            {{ table | safe }}
        </div>
    </div>
    {% endif %}

</div>

</body>
</html>